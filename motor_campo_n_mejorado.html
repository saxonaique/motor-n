<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Motor Campo N - Versión Mejorada con Controles</title>
  <style>
    body {
      background-color: #1a1a1a;
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      width: 100%;
    }
    
    h1 {
      text-align: center;
      color: #00ff88;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
    }
    
    .simulation-area {
      display: flex;
      gap: 30px;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    
    canvas {
      background-color: #ffffff;
      border: 3px solid #00ff88;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
    }
    
    .controls {
      background-color: #2a2a2a;
      padding: 25px;
      border-radius: 15px;
      border: 2px solid #444;
      min-width: 300px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    }
    
    .control-group {
      margin-bottom: 20px;
    }
    
    .control-group label {
      display: block;
      margin-bottom: 8px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .control-group input[type="range"] {
      width: 100%;
      margin-bottom: 5px;
    }
    
    .control-group input[type="button"] {
      background-color: #00ff88;
      color: #1a1a1a;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
      transition: all 0.3s ease;
    }
    
    .control-group input[type="button"]:hover {
      background-color: #00cc6a;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 255, 136, 0.3);
    }
    
    .stats {
      background-color: #333;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      border: 1px solid #555;
    }
    
    .stats h3 {
      margin-top: 0;
      color: #00ff88;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 5px 0;
      border-bottom: 1px solid #444;
    }
    
    .value-display {
      color: #ccc;
      font-size: 0.9em;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Motor Campo N - Zona de Alta Densidad Informacional</h1>
    
    <div class="simulation-area">
      <canvas id="nFieldCanvas" width="500" height="500"></canvas>
      
      <div class="controls">
        <h2 style="color: #00ff88; margin-top: 0;">Controles de Simulación</h2>
        
        <div class="control-group">
          <label for="flowRate">Tasa de Flujo (0.01 - 0.2)</label>
          <input type="range" id="flowRate" min="0.01" max="0.2" step="0.01" value="0.05">
          <div class="value-display" id="flowRateValue">0.05</div>
        </div>
        
        <div class="control-group">
          <label for="noiseHigh">Ruido Alto (0.001 - 0.1)</label>
          <input type="range" id="noiseHigh" min="0.001" max="0.1" step="0.001" value="0.02">
          <div class="value-display" id="noiseHighValue">0.02</div>
        </div>
        
        <div class="control-group">
          <label for="noiseLow">Ruido Bajo (0.001 - 0.02)</label>
          <input type="range" id="noiseLow" min="0.001" max="0.02" step="0.001" value="0.005">
          <div class="value-display" id="noiseLowValue">0.005</div>
        </div>
        
        <div class="control-group">
          <label for="densityThreshold">Umbral de Densidad (0.5 - 0.95)</label>
          <input type="range" id="densityThreshold" min="0.5" max="0.95" step="0.05" value="0.8">
          <div class="value-display" id="densityThresholdValue">0.8</div>
        </div>
        
        <div class="control-group">
          <input type="button" value="Reiniciar Simulación" onclick="resetSimulation()">
          <input type="button" value="Pausar/Reanudar" onclick="togglePause()">
          <input type="button" value="Paso a Paso" onclick="singleStep()">
        </div>
        
        <div class="stats">
          <h3>Estadísticas del Sistema</h3>
          <div class="stat-item">
            <span>Densidad Promedio:</span>
            <span id="avgDensity">0.00</span>
          </div>
          <div class="stat-item">
            <span>Densidad Máxima:</span>
            <span id="maxDensity">0.00</span>
          </div>
          <div class="stat-item">
            <span>Densidad Mínima:</span>
            <span id="minDensity">0.00</span>
          </div>
          <div class="stat-item">
            <span>Entropía del Sistema:</span>
            <span id="entropy">0.00</span>
          </div>
          <div class="stat-item">
            <span>Iteraciones:</span>
            <span id="iterations">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('nFieldCanvas');
    const ctx = canvas.getContext('2d');
    const dim = 50;
    const cellSize = canvas.width / dim;

    let field = [];
    let isRunning = true;
    let iterationCount = 0;
    
    // Parámetros configurables
    let flowRate = 0.05;
    let noiseHigh = 0.02;
    let noiseLow = 0.005;
    let densityThreshold = 0.8;

    function initField() {
      for (let r = 0; r < dim; r++) {
        field[r] = [];
        for (let c = 0; c < dim; c++) {
          // Zona central con alta densidad informacional
          const isHighDensityZone = Math.abs(r - dim/2) < 5 && Math.abs(c - dim/2) < 5;
          field[r][c] = isHighDensityZone
            ? 0.9 + (Math.random() - 0.5) * 0.1 // valores entre 0.85 y 0.95
            : 0.5 + (Math.random() - 0.5) * 0.2; // valores entre 0.4 y 0.6
        }
      }
      iterationCount = 0;
    }

    function drawField() {
      for (let r = 0; r < dim; r++) {
        for (let c = 0; c < dim; c++) {
          const value = field[r][c];
          const gray = Math.floor(value * 255);
          ctx.fillStyle = `rgb(${gray},${gray},${gray})`;
          ctx.fillRect(c * cellSize, r * cellSize, cellSize, cellSize);
        }
      }
    }

    function updateField() {
      const next = [];
      for (let r = 0; r < dim; r++) {
        next[r] = [];
        for (let c = 0; c < dim; c++) {
          let sum = 0;
          let count = 0;
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr;
              const nc = c + dc;
              if (nr >= 0 && nr < dim && nc >= 0 && nc < dim) {
                sum += field[nr][nc];
                count++;
              }
            }
          }
          const avg = sum / count;
          const current = field[r][c];
          const flow = flowRate * (avg - current);

          // Ruido adaptativo
          const noise = (Math.random() - 0.5) * (current > densityThreshold ? noiseHigh : noiseLow);
          next[r][c] = Math.max(0, Math.min(1, current + flow + noise));
        }
      }
      field = next;
      iterationCount++;
    }

    function calculateStats() {
      let sum = 0;
      let max = 0;
      let min = 1;
      let entropy = 0;
      
      for (let r = 0; r < dim; r++) {
        for (let c = 0; c < dim; c++) {
          const value = field[r][c];
          sum += value;
          max = Math.max(max, value);
          min = Math.min(min, value);
          
          // Cálculo de entropía (simplificado)
          if (value > 0) {
            entropy -= value * Math.log2(value);
          }
        }
      }
      
      const avg = sum / (dim * dim);
      entropy = entropy / (dim * dim);
      
      document.getElementById('avgDensity').textContent = avg.toFixed(3);
      document.getElementById('maxDensity').textContent = max.toFixed(3);
      document.getElementById('minDensity').textContent = min.toFixed(3);
      document.getElementById('entropy').textContent = entropy.toFixed(3);
      document.getElementById('iterations').textContent = iterationCount;
    }

    function updateControls() {
      flowRate = parseFloat(document.getElementById('flowRate').value);
      noiseHigh = parseFloat(document.getElementById('noiseHigh').value);
      noiseLow = parseFloat(document.getElementById('noiseLow').value);
      densityThreshold = parseFloat(document.getElementById('densityThreshold').value);
      
      document.getElementById('flowRateValue').textContent = flowRate;
      document.getElementById('noiseHighValue').textContent = noiseHigh;
      document.getElementById('noiseLowValue').textContent = noiseLow;
      document.getElementById('densityThresholdValue').textContent = densityThreshold;
    }

    function step() {
      if (isRunning) {
        updateField();
        drawField();
        calculateStats();
      }
      requestAnimationFrame(step);
    }

    function resetSimulation() {
      initField();
      drawField();
      calculateStats();
    }

    function togglePause() {
      isRunning = !isRunning;
    }

    function singleStep() {
      if (!isRunning) {
        updateField();
        drawField();
        calculateStats();
      }
    }

    // Event listeners para los controles
    document.getElementById('flowRate').addEventListener('input', updateControls);
    document.getElementById('noiseHigh').addEventListener('input', updateControls);
    document.getElementById('noiseLow').addEventListener('input', updateControls);
    document.getElementById('densityThreshold').addEventListener('input', updateControls);

    // Inicialización
    initField();
    drawField();
    calculateStats();
    updateControls();
    requestAnimationFrame(step);
  </script>
</body>
</html>

